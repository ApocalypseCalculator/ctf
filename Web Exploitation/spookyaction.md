# Spooky Action from the Backend

### Problem 

The flag file is located at the root of the server's filesystem, and we appear to have no way to access it. 

### Solution

My first thought is that we can try to spoof the login link to get the webserver to display me the root directory's flag file. However, notice that in the python script they added: `secure_filename()`. So that is a dead end.

The next place I looked is `nginx.conf`, and interestingly enough, there is a configuration block with the following: 
```
location /protected/ {
    internal;
    alias /;
}
```

This means that links with `/protected/` will serve static files from `/` on the webserver. 

Our only roadblock is `internal`. This directive tells the server that it is only for internal requests. 

One way to be "internal" is to have the server send a `X-Accel-Redirect` response header telling us to go to `/protected/flag.txt`

Back to our server.py, we notice a very suspicious looking `add_headers` function, which defines that all `X-` prefixed request headers will be sent directly back in the response. Notice that the "request headers" are actually URL params, and not actual request headers.

A winning payload would then be: 
```
/login?next=yes&headers=X-Accel-Redirect&values=/protected/flag.txt
```

Our flag is then `CTF{wh4t_a_c0ol_f3ature_huh_2556e2b7}`